<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Chapter 7：鬼門遁甲 Pointer 中文：指標 一、Introduction 介紹 指標，是 C 語言中最強而有力的一項特性，也是最多人放棄的一個地方。指標有強力，而且高"><meta property="og:title" content><meta property="og:description" content="Chapter 7：鬼門遁甲 Pointer 中文：指標 一、Introduction 介紹 指標，是 C 語言中最強而有力的一項特性，也是最多人放棄的一個地方。指標有強力，而且高"><meta property="og:type" content="article"><meta property="og:url" content="https://fcuiecs.github.io/ccds/docs/Ch7/Intro/"><meta property="article:modified_time" content="2020-04-10T13:58:09+08:00"><title>Intro | C & C++ & Data Structure Texture Lecture</title><link rel=icon href=https://fcuiecs.github.io/ccds/favicon.png type=image/x-icon><link rel=stylesheet href=https://fcuiecs.github.io/ccds/book.min.eec4362743e12b4651e54612f281492e02ee70367d7677d18cb7588c0cf7c6d7.css integrity="sha256-7sQ2J0PhK0ZR5UYS8oFJLgLucDZ9dnfRjLdYjAz3xtc="><script defer src=https://fcuiecs.github.io/ccds/zh.search.min.1a08fa53686feb65f4c9921a5ad0795a6f44273911927c3b3c60fbda1eb539f3.js integrity="sha256-Ggj6U2hv62X0yZIaWtB5Wm9EJzkRknw7PGD72h61OfM="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://fcuiecs.github.io/ccds/><span>C & C++ & Data Structure Texture Lecture</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder aria-label maxlength=64 data-hotkeys=s/><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://fcuiecs.github.io/ccds/docs/><strong>開卷</strong></a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch0/Intro/><strong>魔工鑄器 Environment</strong></a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch0/01_devcpp/>Dev-C++</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch0/02_codeblocks/>Code::Blocks</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch0/03_visualstudio/>Visual Studio</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch1/Intro/><strong>鑑往知來 C Intro</strong></a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch1/01_history/>C語言背景</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch1/02_language_diff/>低中高階語言</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch1/03_spec/>C語言特性</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch1/04_newbie/>起手式</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch1/05_practice/>練習</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch2/Intro/><strong>五型殺氣 Basic I/O</strong></a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch2/01_stdout/>標準輸出</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch2/02_type/>基本五型</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch2/03_changable/>伸縮自如的型態</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch2/04_stdin/>標準輸入</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch2/05_practice/>練習</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch3/Intro/><strong>扮裝行列 Operation</strong></a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch3/01_arithmetic/>算數運算</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch3/02_bitComputing/>位元運算</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch3/03_assignment/>指派運算</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch3/04_boolean/>布林運算</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch3/05_ifStatement/>判斷式</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch3/06_practice/>練習</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch4/Intro/><strong>循環演算 Loop & Array</strong></a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch4/01_loop/>迴圈簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch4/02_array/>陣列簡介</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch5/Intro/><strong>情報強化 String</strong></a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch5/01_string/>字串簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/>字串處理</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch5/02_bignumber/>大數運算</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch6/Intro/><strong>三千世界 Function</strong></a><ul><li><a href=https://fcuiecs.github.io/ccds/>函式簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/>參數傳遞(Call by value)</a></li><li><a href=https://fcuiecs.github.io/ccds/>遞迴</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch7/Intro/ class=active>鬼門遁甲 Pointer</a><ul><li><a href=https://fcuiecs.github.io/ccds/>指標簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/>參數傳遞(Call by address)</a></li><li><a href=https://fcuiecs.github.io/ccds/>動態記憶體操作</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch8/Intro/>七夜怪談 Structure</a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch8/01_basic/>基礎結構</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch8/02_operation/>結構操作</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch8/03_ptr_structure/>結構指標</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch8/04_practice/>練習</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch9/Intro/>剪紙成兵 File I/O</a><ul><li><a href=https://fcuiecs.github.io/ccds/>檔案結構</a></li><li><a href=https://fcuiecs.github.io/ccds/>檔案輸入輸出</a></li><li><a href=https://fcuiecs.github.io/ccds/>檔案處理</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch10/Intro/>天元突破 C++ Intro</a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch10/01_introduction/>C++簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch10/02_inputAndOutput/>輸入&輸出</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch10/03_boolean/>第六型態</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch10/04_string/>字串(string)</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch10/05_TernaryOperator/>三元運算子</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch10/06_structAndObject/>結構與物件</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch10/07_memoryControl/>記憶體操作</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch11/01_Intro/>人形蜈蚣 Linked List</a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch11/02_Singly_Linked_List/>單向鏈結串列</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch11/03_Doubly_Linked_List/>雙向鏈結串列</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch11/04_Circularly_Linked_List/>循環鏈結串列</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch11/02_Singly_Linked_List_forC/>單向鏈結串列 For C</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch11/03_Doubly_Linked_List_forC/>雙向鏈結串列 For C</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch11/04_Circularly_Linked_List_forC/>循環鏈結串列 For C</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch12/Intro/>陰陽一氣 Queue & Stack</a><ul><li><a href=https://fcuiecs.github.io/ccds/docs/Ch12/01_queue_intro/>佇列簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch12/02_queue_implementation/>實作Queue</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch12/03_stack_intro/>堆疊簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch12/04_stack_implementation/>實作Stack</a></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch12/05_practice/>練習</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch13/Intro/>木葉旋風 Tree</a><ul><li><a href=https://fcuiecs.github.io/ccds/>各種樹簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/>樹的走訪</a></li><li><a href=https://fcuiecs.github.io/ccds/>前序/中序/後序轉換式</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/Ch14/Intro/>木靈迷路 Graph</a><ul><li><a href=https://fcuiecs.github.io/ccds/>各種圖簡介</a></li><li><a href=https://fcuiecs.github.io/ccds/>Kruskal</a></li><li><a href=https://fcuiecs.github.io/ccds/>Prime</a></li><li><a href=https://fcuiecs.github.io/ccds/>Dijkstra</a></li></ul></li><li><a href=https://fcuiecs.github.io/ccds/docs/summary/>總結</a></li></ul><ul><li><a href=https://github.com/FCUIECS/CCDS target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://fcuiecs.github.io/ccds/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Intro</strong>
<label for=toc-control><img src=https://fcuiecs.github.io/ccds/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#chapter-7鬼門遁甲-pointer>Chapter 7：鬼門遁甲 Pointer</a><ul><li><a href=#一introduction-介紹>一、Introduction 介紹</a><ul><li><a href=#取址運算子address-of-operator>取址運算子（Address-of operator）</a></li></ul></li><li><a href=#二definition-定義>二、Definition 定義</a><ul><li><a href=#宣告方式>宣告方式</a></li></ul></li><li><a href=#三how-to-use-使用方式>三、How to use 使用方式</a><ul><li><a href=#提取運算子dereference>提取運算子（Dereference）</a></li><li><a href=#練習-7-1>練習 7-1</a></li></ul></li><li><a href=#四指標的特性>四、指標的特性</a></li><li><a href=#五解-function-的輸入陷阱>五、解 Function 的輸入陷阱</a></li><li><a href=#六指標的安全問題>六、指標的安全問題</a><ul><li><a href=#1釋放不用的指標>1.釋放不用的指標</a></li><li><a href=#2宣告指標後要指向-void-或其他地址>2.宣告指標後，要指向 void 或其他地址</a></li></ul></li><li><a href=#七動態記憶體配置>七、動態記憶體配置</a><ul><li><a href=#1malloc>1.malloc()</a></li><li><a href=#2calloc>2.calloc()</a></li><li><a href=#3realloc>3.realloc()</a></li></ul></li><li><a href=#八真正的指標>八、真正的指標</a><ul><li><a href=#1指標與陣列>1.指標與陣列</a></li><li><a href=#2指標與字串>2.指標與字串</a></li><li><a href=#3指標與結構>3.指標與結構</a></li><li><a href=#4指標與函數>4.指標與函數</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=chapter-7鬼門遁甲-pointer>Chapter 7：鬼門遁甲 Pointer</h1><p>中文：指標</p><h2 id=一introduction-介紹>一、Introduction 介紹</h2><p>指標，是 C 語言中最強而有力的一項特性，也是最多人放棄的一個地方。指標有強力，而且高效能的優點，卻也伴隨著難以撰寫、難以入門、難以理解、難以維護的缺點。其寫法千變萬化，令人嘆為觀止。但是不要怕，只要搞懂了指標的定義，你就踏出成功的第一步了。</p><p>在介紹指標之前，讓我們複習一下變數（Variable）這個機制是如何運作的。</p><p>變數提供了一個有名稱的記憶體位址，當我們宣告 int x = 0; 的時候，其實是系統在記憶體當中找一塊 int 大小的空間，記錄下記憶體位址（像是 0x23ff12，每次不一樣），名稱設為 x。</p><h3 id=取址運算子address-of-operator>取址運算子（Address-of operator）</h3><p>如果我們想知道變數的記憶體位址，可以使用取址運算子「&」：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>) {
	<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
	printf(<span style=color:#e6db74>&#34;Value of x : %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, x);
	printf(<span style=color:#e6db74>&#34;Address of x : %p</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#f92672>&amp;</span>x);
	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

</code></pre></div><p>執行結果為：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>Value of x : <span style=color:#ae81ff>10</span>
Address of x : <span style=color:#ae81ff>0x23ff12</span>
</code></pre></div><p>也就是說，記憶體位置 0x23ff12 這個地方放著 10，這個地方的名字叫做 x。</p><p>而我們這章節要介紹的 Pointer 指標，是一種型態，專門儲存記憶體位址。就像是一個指標指向某一個地方。簡單來說，指標指向記憶體位址。</p><h2 id=二definition-定義>二、Definition 定義</h2><h3 id=宣告方式>宣告方式</h3><p>指標的宣告方式為：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
type <span style=color:#f92672>*</span>ptr;

</code></pre></div><p>例如：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>ptr;
<span style=color:#66d9ef>float</span> <span style=color:#f92672>*</span>ptr2;
<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>ptr3;

</code></pre></div><p>宣告指標必須宣告型態，讓 Compiler 可以知道目標記憶體位址上的資料要如何解釋。</p><h2 id=三how-to-use-使用方式>三、How to use 使用方式</h2><p>我們必須把指標指向某個記憶體位址，可以這樣寫：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>ptr <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>x;

</code></pre></div><p>或是</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>ptr;

ptr <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>x;

</code></pre></div><p>這樣子寫，代表宣告 ptr 是一個 int 型態的指標，指向變數 x 的記憶體位址。</p><h3 id=提取運算子dereference>提取運算子（Dereference）</h3><p>如果要取得這個記憶體的值，我們要用 * 提取運算子。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>ptr <span style=color:#f92672>&amp;</span>x;;

printf(<span style=color:#e6db74>&#34;The value of x : %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, x);
printf(<span style=color:#e6db74>&#34;The value of address where ptr point : %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#f92672>*</span>x);

</code></pre></div><p>執行結果為：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>The value of x : <span style=color:#ae81ff>10</span>
The value of address where ptr point : <span style=color:#ae81ff>10</span>
</code></pre></div><p>如果我們把全部都 print 出來比較的話：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>ptr <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>x;;

printf(<span style=color:#e6db74>&#34;The value of x : %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, x);
printf(<span style=color:#e6db74>&#34;The address of x : %p</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#f92672>&amp;</span>x);
printf(<span style=color:#e6db74>&#34;The address where ptr point : %p</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ptr);
printf(<span style=color:#e6db74>&#34;The value of address where ptr point : %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#f92672>*</span>ptr);
printf(<span style=color:#e6db74>&#34;The address of pointer ptr : %p</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#f92672>&amp;</span>ptr);

</code></pre></div><p>執行結果應該會像以下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>The value of x : <span style=color:#ae81ff>10</span>
The address of x : <span style=color:#ae81ff>0x12fe1e</span>
The address where ptr point : <span style=color:#ae81ff>0x12fe1e</span>
The value of address where ptr point : <span style=color:#ae81ff>10</span>
The address of pointer ptr : <span style=color:#ae81ff>0xfa131a</span>
</code></pre></div><p>不要忘記指標也擁有自己的記憶體位址。</p><hr><h3 id=練習-7-1>練習 7-1</h3><p>設計一個 float 型態的指標，並且像範例一樣 print 出來看看位址與數值。</p><hr><h2 id=四指標的特性>四、指標的特性</h2><p>我們寫了一個以下的程式：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>ptr <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>x;

</code></pre></div><p>並且對 ptr 所指向的值做修改：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#f92672>*</span>ptr <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>;

</code></pre></div><p>這時候值會如何變化呢？我們 print 出來看看：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
printf(<span style=color:#e6db74>&#34;The value of address where ptr point : %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#f92672>*</span>ptr);
printf(<span style=color:#e6db74>&#34;The value of x : %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, x);

</code></pre></div><p>執行結果如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>The value of address where ptr point : <span style=color:#ae81ff>20</span>
The value of x : <span style=color:#ae81ff>20</span>
</code></pre></div><p>由於指標 ptr 指向的記憶體位址和變數 x 所代表的記憶體位址是同樣的，於是我們修改了 ptr 指標所指向的記憶體位址的值，也同樣修改了變數 x 的值。</p><p>實務上，這種特性可以讓你有許多種用法，其中一種最基本的，就是拿來解我們在上一章節所提到的 Function 問題。</p><h2 id=五解-function-的輸入陷阱>五、解 Function 的輸入陷阱</h2><p>上一章提到，假設我們要設計一個 Function，功能為交換兩個整數值，會遇到一些問題，原因是在 Function 中使用的變數和外面的變數是不同的，為了解決這個問題，我們必須使用上述指標的特性。</p><p>愚蠢的你大概還沒想到怎麼做，簡單說，就是我們把記憶體位址當作 Function 的參數傳進去！</p><p>原本的程式應該是這樣：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>swap</span>(<span style=color:#66d9ef>int</span> x, <span style=color:#66d9ef>int</span> y) {
	<span style=color:#66d9ef>int</span> tmp;
	tmp <span style=color:#f92672>=</span> x;
	x <span style=color:#f92672>=</span> y;
	y <span style=color:#f92672>=</span> tmp;
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>, y <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
	printf(<span style=color:#e6db74>&#34;Before : x = %d, y = %d&#34;</span>, x, y );
	swap(x, y);
	printf(<span style=color:#e6db74>&#34;After : x = %d, y = %d&#34;</span>, x, y );
	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

</code></pre></div><p>我們改成這樣：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>swap</span>(<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>x, <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>y) {
	<span style=color:#66d9ef>int</span> tmp;
	tmp <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>x;
	<span style=color:#f92672>*</span>x <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>y;
	<span style=color:#f92672>*</span>y <span style=color:#f92672>=</span> tmp;
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>, y <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
	printf(<span style=color:#e6db74>&#34;Before : x = %d, y = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, x, y );

	<span style=color:#75715e>//傳記憶體位址進去
</span><span style=color:#75715e></span>	swap(<span style=color:#f92672>&amp;</span>x, <span style=color:#f92672>&amp;</span>y);

	printf(<span style=color:#e6db74>&#34;After : x = %d, y = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, x, y );
	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

</code></pre></div><p>執行結果：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>Before : x <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>, y <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
After : x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>, y <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</code></pre></div><p>x, y 成功被交換了！如果你不知道為什麼，從頭再看一次指標的定義吧！</p><h2 id=六指標的安全問題>六、指標的安全問題</h2><p>說起來，這麼強大的武器就像雙面刃一樣，指標的好處是可以快速的直接進行記憶體存取，然而壞處卻也相同。萬一不小心修改到不應該修改的地方，程式可是會直接掛掉的。更慘的是，由指標所造成的 bug 通常很難被找到，甚至是修復。在這裡，我們稍微學習一下關於指標的安全問題。</p><h3 id=1釋放不用的指標>1.釋放不用的指標</h3><p>為了避免有許多已不必要的指標掌控著記憶體，指標若不使用就應該被釋放掉。使用方式很簡單，使用 free() 函式即可。使用 free() 釋放指標後，記憶體空間將被歸還給系統，避免程式占用大量記憶體。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>ptr;

...

free(ptr);

</code></pre></div><h3 id=2宣告指標後要指向-void-或其他地址>2.宣告指標後，要指向 void 或其他地址</h3><p>假設有一程式如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>
<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>ptr;

<span style=color:#f92672>*</span>ptr <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;

</code></pre></div><p>這將會發生大問題，為什麼？<br>當宣告了一個指標後，代表某一塊記憶體空間被拿來當作是 int 型態指標的空間，但是這個空間原本可能有某些資料沒有被清掉。於是，你的指標正指向一個未知的區域，有時候不小心就可能造成大問題。</p><p>所以最好都先給 void。</p><h2 id=七動態記憶體配置>七、動態記憶體配置</h2><p>到目前為止我們都是講述一般的記憶體配置方式，假若需要一塊整數空間，我們就宣告 int 變數；需要 10 個，我們就宣告 int 陣列。不過，這樣的使用方式無法滿足實務上的需求。</p><p>例如，今天我們需要寫一個校務系統，但沒辦法確定每年的學生人數都一樣。這時候用陣列，如果人太少，就浪費空間；人太多，根本不夠用。我們沒辦法提前知道要多少記憶體空間，只能見招拆招。這時候用到的，就是動態記憶體配置。</p><h3 id=1malloc>1.malloc()</h3><h3 id=2calloc>2.calloc()</h3><h3 id=3realloc>3.realloc()</h3><h2 id=八真正的指標>八、真正的指標</h2><p>上述提到的用法，對於各位來說真正有用的應該只有在 Function 的部分，各位可能有很多疑問，這東西這麼抽象，這麼難學，到底有什麼用？別急，接著就是要教你指標的各種型態。</p><h3 id=1指標與陣列>1.指標與陣列</h3><h3 id=2指標與字串>2.指標與字串</h3><h3 id=3指標與結構>3.指標與結構</h3><h3 id=4指標與函數>4.指標與函數</h3></article><footer class=book-footer><div class="flex justify-between"><div><a class="flex align-center" href=https://github.com/FCUIECS/CCDS/commit/b8a4a3482129f425d4f388335a4ec697f9d367be title="Vongola | Apr 10, 2020" target=_blank rel=noopener><img src=https://fcuiecs.github.io/ccds/svg/calendar.svg class=book-icon alt=Calendar>
<span>Apr 10, 2020</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#chapter-7鬼門遁甲-pointer>Chapter 7：鬼門遁甲 Pointer</a><ul><li><a href=#一introduction-介紹>一、Introduction 介紹</a><ul><li><a href=#取址運算子address-of-operator>取址運算子（Address-of operator）</a></li></ul></li><li><a href=#二definition-定義>二、Definition 定義</a><ul><li><a href=#宣告方式>宣告方式</a></li></ul></li><li><a href=#三how-to-use-使用方式>三、How to use 使用方式</a><ul><li><a href=#提取運算子dereference>提取運算子（Dereference）</a></li><li><a href=#練習-7-1>練習 7-1</a></li></ul></li><li><a href=#四指標的特性>四、指標的特性</a></li><li><a href=#五解-function-的輸入陷阱>五、解 Function 的輸入陷阱</a></li><li><a href=#六指標的安全問題>六、指標的安全問題</a><ul><li><a href=#1釋放不用的指標>1.釋放不用的指標</a></li><li><a href=#2宣告指標後要指向-void-或其他地址>2.宣告指標後，要指向 void 或其他地址</a></li></ul></li><li><a href=#七動態記憶體配置>七、動態記憶體配置</a><ul><li><a href=#1malloc>1.malloc()</a></li><li><a href=#2calloc>2.calloc()</a></li><li><a href=#3realloc>3.realloc()</a></li></ul></li><li><a href=#八真正的指標>八、真正的指標</a><ul><li><a href=#1指標與陣列>1.指標與陣列</a></li><li><a href=#2指標與字串>2.指標與字串</a></li><li><a href=#3指標與結構>3.指標與結構</a></li><li><a href=#4指標與函數>4.指標與函數</a></li></ul></li></ul></li></ul></nav></aside></main></body></html>